<!DOCTYPE html>
<html lang="de">
<head>
    <script src="https://meet.jit.si/external_api.js"></script>
    <title>Jitsi Meet Face Detection</title>
</head>
<body>
<div id="meet"></div>
<script>
    const domain = "meet.jit.si";
    const options = {
        roomName: "40123124141413154236436523",
        width: 1600,
        height: 900,
        parentNode: document.querySelector('#meet'),
        interfaceConfigOverwrite: { /* Interface Einstellungen */},
        configOverwrite: { /* Weitere Konfigurationen */}
    };
    const api = new JitsiMeetExternalAPI(domain, options);

    function addLightbulb(id) {
        
    }

    api.addEventListener('participantJoined', () => {
        console.log('Ein Teilnehmer ist der Konferenz beigetreten!');
        // Rufe die Capture- und Detect-Methoden auf
        fetch('http://127.0.0.1:5000/capture', {method: 'POST'})
            .then(() => {
                return fetch('http://127.0.0.1:5000/detect', {method: 'POST'});
            })
            .then(response => response.json())
            .then(data => {
                console.log('Erkennungsdaten:', data);
                // Überprüfe den Wert von isRecognized
                if (!data.isRecognized) {
                    // Wenn die Kontrollperson nicht erkannt ist, zeige eine Warnung oder Button
                    alert('Kontrollperson nicht erkannt oder nicht alleine im Bild!');
                    // Hier kannst du einen Button anzeigen oder andere UI-Aktionen durchführen
                    addLightbulb(participant.id)
                }
            })
            .catch(error => console.error('Fehler bei der Anfrage:', error));
    });

    // Optional: Cronjob-ähnliche Funktion, um die Erkennung regelmäßig aufzurufen
    setInterval(() => {
        fetch('http://127.0.0.1:5000/detect', {method: 'POST'})
            .then(response => response.json())
            .then(data => {
                console.log('Periodische Erkennung:', data);
                if (!data.isRecognized) {
                    alert('Kontrollperson nicht erkannt oder nicht alleine im Bild!');
                }
            })
            .catch(error => console.error('Fehler bei der Anfrage:', error));
    }, 10000);  // Alle 10 Sekunden
</script>
</body>
</html>